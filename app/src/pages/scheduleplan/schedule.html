<form class="ui form">
    <div class="three fields">
        <div class="field">
            <label>When to schedule</label>
            <div style="margin: .5rem 0" data-bind="text: formatEventId(eventIdObs())"></div>
            <div class="inline-editor-controls">
                <a data-bind="click: editEventId"><i class="write icon"></i>Edit</a>
                <a data-bind="click: clearEventId"><i class="trash icon"></i>Clear</a>
            </div>
        </div>
        <div class="field">
            <label>Schedule Type</label>
            <ui-select params="fieldObs: scheduleTypeObs, fieldLabel: scheduleTypeLabel,
                publishedObs: publishedObs, optionsSrc: scheduleTypeOptions"></ui-select>
        </div>
    </div>
    <div class="three fields">
        <div class="field">
            <label data-bind="text: (scheduleTypeObs() === 'recurring') ? 'At these times' : 'At this time'"></label>
            <div style="margin: .5rem 0" data-bind="text: formatTimes(timesObs())"></div>
            <div class="inline-editor-controls">
                <a data-bind="click: editTimes"><i class="write icon"></i>Edit</a>
                <a data-bind="click: clearTimes"><i class="trash icon"></i>Clear</a>
            </div>

        </div>
        <div class="field" data-bind="visible: scheduleTypeObs() === 'recurring'">
            <label>Then schedule every</label>
            <ui-duration params="fieldObs: intervalObs, noHours: true"></ui-duration>
        </div>
        <div class="field" data-bind="visible: scheduleTypeObs() === 'recurring'">
            <label>or repeat using this cron expression</label>
            <ui-text params="fieldObs: cronTriggerObs, publishedObs: publishedObs"></ui-text><br> <a href="http://www.cronmaker.com/" target="_blank">Online tool to make one</a>
        </div>
    </div>
    <div class="three fields">
        <div class="field">
            <label>Delay first task by</label>
            <ui-duration params="fieldObs: delayObs"></ui-duration>
        </div>
        <div class="field">
            <label>Tasks expire after</label>
            <ui-duration params="fieldObs: expiresObs"></ui-duration>
        </div>
    </div>
    <fieldset>
        <legend>Scheduling Window (UTC time)</legend>
        <div class="three fields">
            <div class="field">
                <label>Only schedule tasks after</label>
                <ui-datetime params="fieldObs: startsOnObs, publishedObs: publishedObs"></ui-datetime>
            </div>
            <div class="field">
                <label>And stop after</label>
                <ui-datetime params="fieldObs: endsOnObs, publishedObs: publishedObs"></ui-datetime>
            </div>
        </div>
        <p class="help-text">Tasks will not be scheduled outside of this time window, if set. The times are in UTC and apply to all participants in the study, wherever they are located, at the same time. </p>
    </fieldset>
    <h5>Activities</h5>
    <div class="ui form" data-bind="visible: activitiesObs().length == 0">
        <a class="ui primary button" data-bind="click: addFirstActivity">
            <i class="add square icon"></i>Add Activity
        </a>
    </div>
    <div data-bind="visible: activitiesObs().length > 0">
        <div class="ui form" data-bind="foreach: activitiesObs">
            <div class="activity">
                <div>
                    <input type="text" placeholder="Label" data-bind="textInput: $data.labelObs"/>
                </div>
                <div>
                    <input type="text" placeholder="Label Detail" data-bind="textInput: $data.labelDetailObs"/>
                </div>
                <div>
                    <ui-select params="fieldObs: $data.activityTypeObs, fieldLabel: $component.activityTypeLabel,
                        publishedObs: $component.publishedObs, optionsSrc: $component.activityTypeOptions"></ui-select>
                </div>
                <div style="width: 10rem" data-bind="visible: $data.activityTypeObs() == 'task'">
                    <input type="text" placeholder="Task ID" data-bind="textInput: $data.taskIdObs"/>
                </div>
                <div style="width: 10rem" data-bind="visible: $data.activityTypeObs() == 'survey'">
                    <ui-select params="fieldObs: $data.surveyGuidObs, fieldLabel: $component.surveysOptionsLabel,
                        publishedObs: $component.publishedObs, optionsSrc: $component.surveysOptionsObs"></ui-select>
                </div>
                <div>
                    <div class="inline-form-text activity-controls">
                        <a href="#" data-bind="click: $component.deleteActivity">
                            <i class="trash icon"></i>Delete
                        </a>
                        <a href="#" data-bind="click: $component.addActivityAfter">
                            <i class="square add icon"></i>Add Below
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
