<div class="fixed-header">
    <div class="fixed-header-title">
        <div class="fixed-header-heading">
            <div class="ui breadcrumb">
                <a href="#/schemas" class="section">Upload Schemas</a>
                <i class="right chevron icon divider"></i>
            </div>             
            <h3>
                <span data-bind="visible: nameObs().length > 0, text: nameObs"></span>
                <span data-bind="visible: nameObs().length === 0">New Upload Schema</span>
            </h3>
        </div>
        <div class="fixed-header-buttons">
            <button class="ui small primary button" data-bind="click: save">Save</button>
        </div>
    </div>
    <div class="ui secondary pointing menu" data-bind="visible: !isNewObs()">
        <span class="active item">
            <i class="file outline icon"></i> Editor
        </span>
        <a data-bind="attr: {href: '#/schemas/'+encodeURIComponent(schemaIdObs())+'/versions'}" class="item">
            <i class="history icon"></i> History
        </a>
        <div class="right menu">
            <div class="item">
                <i class="clock icon"></i> <span data-bind="text: revisionLabel"></span>
            </div>
        </div>
    </div>
    <div class="ui empty secondary pointing menu" data-bind="visible: isNewObs"></div>
</div>
<div class="scrollbox">
    <div class="ui warning icon message" style="margin-bottom: 1.4rem" data-bind="visible: showErrorObs">
        <i class="check warningsign icon"></i>
        <div class="content">
            <div class="header">Schema is not backwards compatible</div>
            <p style="margin-top:1rem">You&lsquo;ve made changes that are not backwards compatible. If you 
                are sending data to Bridge using this schema revision, the server would start rejecting 
                the data. You can save it under a new revision, or keep editing. </p>
                
            <p style="margin-bottom:1.5rem">(To maintain backwards compatibility, you can't delete or modify existing fields.)</p>
            <div class="button-container">
                <button class="ui primary button" data-bind="click: saveNewRevision">Save as new revision</button>
                <button class="ui button" data-bind="click: closeWarning">Close</button>
            </div>
        </div>
    </div>    
    <form class="ui form">
        <errors></errors>
        <div class="three fields">
            <div class="required field" id="name">
                <label>Name</label>
                <input type="text" data-bind="textInput: nameObs, hasFocus: true"/>
            </div>
            <div class="required field" id="schemaType">
                <label>Schema Type</label>
                <ui-select params="fieldObs: schemaTypeObs, fieldLabel: schemaTypeLabel, optionsSrc: schemaTypeOptions"></ui-select>
            </div>
            <div class="two fields" data-bind="visible: isNewObs">
                <div class="required field" id="schemaId">
                    <label>Identifier</label>
                    <input type="text" data-bind="textInput: schemaIdObs"/>
                </div>
                <div class="field">
                    <label>Revision</label>
                    <input type="text" data-bind="textInput: revisionObs, semantic: 'popup'"
                        data-content="Leave this blank and we&rsquo;ll save it as &quot;revision 1.&quot; Which is what you want. But if you&rsquo;re some kind of Bridge server wizard, you can pick another revision to use, usually to fix a past mistake."/>
                </div>
            </div>
            <div class="field" data-bind="visible: !isNewObs()">
                <label>Identifier</label>
                <input readonly data-bind="value: schemaIdObs"/>
            </div>
        </div>
    </form>

    <h3>Field Definitions</h3>

    <p class="help-text">Drag items to reorder them. </p>

    <div data-bind="visible: fieldDefinitionsObs().length === 0">
        <p>There are currently no field definitions in this upload schema.</p>
        <p>
            <button class="ui primary button" data-bind="click: addFirst">
                <i class="add square icon"></i> Add Field
            </button>
        <p>
    </div>
    <div class="ui form schema sfieldZone" data-bind="dragula: {
        elementSelector: '.field_definitions',
        dragHandleSelector: '.draggable',
        listObs: fieldDefinitionsObs
    }, foreach: fieldDefinitionsObs">
        <div class="field_definitions" data-bind="component: {
            name: 'field_definition',
            params: { field: $data, itemsObs: $parent.itemsObs, indexObs: $index }
        }"></div>
    </div>
</div>
